/*  *  Project: Email Decryptor  *  Description: Decodes email crypts  *  Author: Eddy Pytlowany <ed.pytlowany@gmail.com>  *  License:   */  ;(function ( $, window, document, undefined ) {          if($ === undefined)         return;      // Create the defaults once     var ns          = 'ep\\utils',         pluginName  = 'email_decrypt',         defaults    = {             //propertyName: "value"         };      // The actual plugin constructor     function Plugin( element, options ) {                  this.element    = element;         this.stream     = $(this.element).data('stream');                  this.options = $.extend( {}, defaults, options) ;          this._defaults = defaults;         this._name = pluginName;          this._init();     }          function decryptMailto(){           var $this   = $(this),             ref     = $this.data('href'),             e       = '',             r       = '',             n       = null,             salt    = false;              if(ref){                  for (var i = 0; i < ref.length; i = i + 2)                      e += ref.substring(i + 1, i + 2) + ref.substring(i, i + 1)                  salt    = 1 * String.fromCharCode(e.substr(-2));                 ref     = e.substr(0, e.length - 2).replace(/\/\*\*(.*?)\*\*\//gi, function(){                     return String.fromCharCode(1 * arguments[1]);                 });                  for (var i = 0; i < ref.length; i++)                     r += String.fromCharCode(ref.charCodeAt(i) - salt);                   $this.removeAttr('data-href');                 $this.removeData('href');                  this.href = r;                  if(Modernizr && Modernizr.touch)                     window.location.href = r;              }      }          $.extend(Plugin.prototype, {                  _init           : function(){                          var decrypted   = this.decode(this.stream),                 html        = '';                                      if(decrypted){                                  html            = document.createElement('div');                 html.innerHTML  = decrypted;                 this.node       = html.firstChild;                 this.element.parentNode.replaceChild(this.node, this.element);                              }                                   },                  decode          : function(stream){                          if(!stream)                 return false;                          return eval(stream.replace(/%(\w+)/g, function(){                 return String.fromCharCode(parseInt(arguments[1], 16));             }))                      }              });       // e.g. $(element).defaultPluginName('functionName', arg1, arg2)     $.fn[pluginName] = function ( options ) {         var args = Array.prototype.slice.call( arguments, 1 );          if (options === undefined || typeof options === 'object') {                          return this.each(function () {                  if (!$.data(this, ns + '\\' + pluginName)){                      $.data(this, ns + '\\' + pluginName, new Plugin( this, options ));                                  }                              });          } else if (typeof options === 'string' && options[0] !== '_') {              var returns;              this.each(function () {                 var instance = $.data(this, ns + '\\' + pluginName);                  if (instance instanceof Plugin && typeof instance[options] === 'function') {                      returns = instance[options].apply( instance, args);                 }                  if (options === 'destroy') {                     $.data(this, ns + '\\' + pluginName, null);                 }             });              return returns !== undefined ? returns : this;         }     };          // Auto decrypt encrypted email addresses     $(document).ready(function(){                  $('[type="text/email-crypt"]').email_decrypt();              }).on('mouseover focus', '[data-href]', decryptMailto);   }(jQuery, window, document));